<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>KI-Readiness-Report 2025</title>
  
  {# Ensure BASE_URL is processed correctly without escaping the slash in Jinja #}
  {% if BASE_URL %}<base href="{{ BASE_URL.rstrip('/') }}/templates/">{% endif %}
<style>
body {
  background: #fff;
  margin: 0;
  padding: 0;
  font-family: 'Inter', Arial, sans-serif;
  color: #223561;
}
.logo-row {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 38px;
  margin-top: 24px;
  margin-bottom: 22px;
}
.logo-row img {
  height: 74px;
  object-fit: contain;
}
h1 {
  font-size: 2.5em;
  text-align: center;
  color: #1e3a8a;
  letter-spacing: 1.5px;
  font-weight: 700;
  margin: 38px 0 12px 0;
  text-shadow: 0 1px 0 #e3ebfa;
}
h2 {
  color: #2563eb;
  font-size: 1.25em;
  font-weight: 700;
  margin-top: 0;
  margin-bottom: 18px;
  border-bottom: 1.5px solid #e8eefd;
  padding-bottom: 4px;
  letter-spacing: 0.7px;
}
.subtitle {
  font-size: 1.21em;
  text-align: center;
  color: #1e40af;
  margin-bottom: 42px;
  font-weight: 500;
  letter-spacing: 0.6px;
}
.chapter-box {
  background: #f4f8fc;
  border-radius: 16px;
  padding: 30px 32px;
  margin: 0 auto 21px auto;
  max-width: 16cm;
  color: #223561;
  /* leicht reduzierte Grundschrift für bessere Lesbarkeit und weniger Zeilenumbrüche */
  font-size: 1.05em;
  line-height: 1.65;
  page-break-inside: avoid;
  word-break: break-word;
  border: 1.25px solid #d1e3fa;
  box-shadow: 0 2px 14px #e8eefd3b;
}
.chapter-box--vision {
  background: #fff8e6;
  border-left: 5px solid #f59e0b;
}
ul, ol {
  margin-left: 0;
  margin-bottom: 1.2em;
  /* Verhindere Seitenumbrüche innerhalb von Listen */
  page-break-inside: avoid;
  padding-left: 1.5em;
  list-style-position: outside;
}

li {
  margin-bottom: 0.4em;
  page-break-inside: avoid;
}
b { color: #2563eb; }
@page {
  margin: 32mm 18mm 28mm 18mm;
  @bottom-center {
    content: "TÜV-zertifiziertes KI-Management • © 2025: Wolf Hohl | "
      "kontakt@ki-sicherheit.jetzt | Seite " counter(page) " von " counter(pages);
    color: #aab8cc;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 9pt;
    opacity: 0.81;
  }
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1em;
  margin-bottom: 1.5em;
  font-size: 1.05em;
  border: 1px solid #d1e3fa;
}
th, td {
  border: 1px solid #d1e3fa;
  padding: 8px 10px;
  text-align: left;
}
th {
  background-color: #e7f0fd;
  color: #1e40af;
  font-weight: 600;
}

thead { display: table-header-group; }
tfoot { display: table-footer-group; }
tr, td, th { page-break-inside: avoid; break-inside: avoid; }
.table, .table tbody, .table tr { page-break-inside: avoid; break-inside: avoid; }
.icon-row {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 16px;
  margin-bottom: 8px;
}
.icon-row img {
  height: 26px;
  vertical-align: middle;
}
.score-box {
  /* Verwende eine CI-konforme Blauton-Box für den Score */
  background: #e7f0fd;
  border-left: 5px solid #2563eb;
  padding: 20px 28px;
  margin: 0 auto 26px auto;
  max-width: 16cm;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(37, 99, 235, 0.12);
  font-size: 1.15em;
  color: #153e75;
}
.score-box b {
  color: #1e40af;
}

/* Charts */
.chart-group { display:flex; flex-direction: column; gap:24px; }
.chart-card { background:#f9fbff; border:1px solid #dbe8ff; border-radius:14px; padding:18px; }
.chart-card h3 { margin:0 0 10px 0; font-size:1.05em; color:#1e3a8a; }
canvas { max-width: 100%; height: auto; }
  </style>

  <!-- Chart.js für Visualisierung -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Daten für die Visualisierung (von gpt_analyze.py geliefert)
    window.__CHART_DATA__ = {{ chart_data_json | default('{}') | safe }};
  </script>
</head>
<body>

{% set wants_funding = (interesse_foerderung in ['ja', 'unklar']) if interesse_foerderung is defined else True %}

<!-- LOGO-ZEILE -->
<div class="logo-row">
  <img src="{{ KI_READY_BASE64 or 'ki-ready-2025.webp' }}" alt="KI-Ready 2025" />
  <img src="{{ KI_SICHERHEIT_BASE64 or 'ki-sicherheit-logo.png' }}" alt="KI-Sicherheit.jetzt" />
</div>

<!-- TITELSEITE -->
<div class="report-section">
  <div>
    <h1>KI-Readiness-Report 2025</h1>
    <div class="subtitle">Zukunftssichere KI-Strategie für Unternehmen</div>
  </div>
</div>

<!-- ICON-ZEILE RECHTS OBEN -->
<div class="icon-row">
  <img src="{{ DSGVO_BASE64 or 'dsgvo.svg' }}" alt="DSGVO-Konform" title="DSGVO-Konform" />
  <img src="{{ EU_AI_BASE64 or 'eu-ai.svg' }}" alt="EU AI Act Ready" title="EU AI Act Ready" />
</div>

<!-- SCORE-ÜBERSICHT -->
{% if score_percent %}
<div class="score-box">
  <p><b>KI-Readiness-Score:</b> {{ score_percent }} % von 100 %</p>
  <p>Dieser Wert zeigt, wie gut Ihr Unternehmen aktuell für den Einsatz von KI vorbereitet ist. Je höher der Wert, desto stärker sind Ihre digitale Reife, Ihre Automatisierung und Ihr internes Know-how ausgeprägt.</p>
</div>
{% endif %}

<!-- STATISCHE EINFÜHRUNG (PREFACE) -->
{% if preface %}
<div class="report-section">
  <div class="chapter-box" style="background:#e7f0fd; border-left:4px solid #2563eb;">
    {{ preface | safe }}
  </div>
</div>
{% endif %}

{# Flags für Inhaltsverzeichnis #}
{% set has_vision = vision_html %}
{% set has_exec = exec_summary_html %}
{% set has_visuals = chart_data_json %}
{% set has_qw = quick_wins_html or risks_html %}
{% set has_rec = recommendations_html %}
{% set has_roadmap = roadmap_html %}
{% set has_sections = sections_html %}

<!-- INHALTSVERZEICHNIS -->
{% if has_vision or has_exec or has_visuals or has_qw or has_rec or has_roadmap or has_sections %}
<div class="report-section">
  <div class="chapter-box" style="box-shadow:none;">
    <h2>Inhaltsverzeichnis</h2>
    <ul>
      {% if has_vision %}<li>Visionäre Empfehlung</li>{% endif %}
      {% if has_exec %}<li>Executive Summary</li>{% endif %}
      {% if has_visuals %}<li>Visualisierung</li>{% endif %}
      {% if has_qw %}<li>Quick Wins &amp; Risiken</li>{% endif %}
      {% if has_rec %}<li>Empfehlungen</li>{% endif %}
      {% if has_roadmap %}<li>Roadmap</li>{% endif %}
      {% if has_sections %}<li>Weitere Kapitel</li>{% endif %}
    </ul>
  </div>
</div>
{% endif %}

<!-- VISIONÄRE EMPFEHLUNG -->
{% if vision_html %}
<div class="report-section" style="page-break-before: always;">
  <div class="chapter-box chapter-box--vision">
    <h2>Visionäre Empfehlung</h2>
    <div>{{ vision_html | safe }}</div>
  </div>
</div>
{% endif %}

<!-- EXECUTIVE SUMMARY -->
{% if exec_summary_html %}
<div class="report-section" style="page-break-before: always;">
  <div class="chapter-box">
    <h2>Executive Summary</h2>
    <div>{{ exec_summary_html | safe }}</div>
  </div>
</div>
{% endif %}

<!-- VISUALISIERUNG (Score & Benchmarks) -->
{% if chart_data_json %}
<div class="report-section" style="page-break-before: always;">
  <div class="chapter-box">
    <h2>Visualisierung</h2>
    <div class="chart-group">
      <div class="chart-card">
        <h3>Readiness-Score</h3>
        <canvas id="chart_score"></canvas>
      </div>
      <div class="chart-card">
        <h3>Benchmarks</h3>
        <canvas id="chart_benchmarks"></canvas>
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- QUICK WINS & RISIKEN -->
{% if quick_wins_html or risks_html %}
<div class="report-section" style="page-break-before: always;">
  <div class="chapter-box">
    <h2>Quick Wins &amp; Risiken</h2>
    {% if quick_wins_html %}
      <div><b>Quick Wins:</b> {{ quick_wins_html | safe }}</div>
    {% endif %}
    {% if risks_html %}
      <div style="margin-top:1em;"><b>Risiken:</b> {{ risks_html | safe }}</div>
    {% endif %}
  </div>
</div>
{% endif %}

<!-- EMPFEHLUNGEN -->
{% if recommendations_html %}
<div class="report-section" style="page-break-before: always;">
  <div class="chapter-box">
    <h2>Empfehlungen</h2>
    <div>{{ recommendations_html | safe }}</div>
  </div>
</div>
{% endif %}

<!-- ROADMAP -->
{% if roadmap_html %}
<div class="report-section" style="page-break-before: always;">
  <div class="chapter-box">
    <h2>Roadmap</h2>
    <div>{{ roadmap_html | safe }}</div>
  </div>
</div>
{% endif %}

<!-- WEITERE KAPITEL (Tools, Förderprogramme, Compliance, Praxisbeispiel …) -->
{% if sections_html %}
<div class="report-section" style="page-break-before: always;">
  <div class="chapter-box">
    <h2>Weitere Kapitel</h2>
    <div>{{ sections_html | safe }}</div>
  </div>
</div>
{% endif %}

<!-- Dynamische Live-Websuche: Förderprogramme & Tools (bleibt) -->
{% if wants_funding and websearch_links_foerder %}
<div class="report-section" style="page-break-before: always;">
  <div class="chapter-box" style="background: #f9fbfd; border-left: 5px solid #57c7fa;">
    <h2 style="color: #0e568a;">Tagesaktuelle Förderprogramme:</h2>
    <div style="font-size:1.07em; color:#154e70; margin-bottom:0;">
      {{ websearch_links_foerder | safe }}
    </div>
    <div style="margin-top:10px; font-size:0.98em; color:#2279b6;">
      <em>Quelle: Google-Suchergebnisse via SerpAPI, automatisch generiert am {{ datum }}.</em>
    </div>
  </div>
</div>
{% endif %}

{% if websearch_links_tools %}
<div class="report-section" style="page-break-before: always;">
  <div class="chapter-box" style="background: #f9fbfd; border-left: 5px solid #57c7fa;">
    <h2 style="color: #0e568a;">Aktuelle KI-Tools & Software:</h2>
    <div style="font-size:1.07em; color:#154e70; margin-bottom:0;">
      {{ websearch_links_tools | safe }}
    </div>
    <div style="margin-top:10px; font-size:0.98em; color:#2279b6;">
      <em>Quelle: Google-Suchergebnisse via SerpAPI, automatisch generiert am {{ datum }}.</em>
    </div>
  </div>
</div>
{% endif %}

<footer>
  {{ footer_text }}
</footer>

<!-- Charts Rendering -->
<script>
(function(){
  const D = window.__CHART_DATA__ || {};
  if (!D || typeof D !== 'object') return;

  // Score Donut
  const elScore = document.getElementById('chart_score');
  if (elScore && window.Chart && D.score != null) {
    new Chart(elScore.getContext('2d'), {
      type: 'doughnut',
      data: {
        labels: ['Readiness', ''],
        datasets: [{
          data: [D.score, Math.max(0, 100 - D.score)],
          backgroundColor: ['#2563eb', '#e8eefd']
        }]
      },
      options: { cutout: '70%', plugins: { legend: { display: false } } }
    });
  }

  // Benchmarks Bar
  const elBench = document.getElementById('chart_benchmarks');
  if (elBench && window.Chart && D.dimensions && D.dimensions.labels && D.dimensions.values) {
    new Chart(elBench.getContext('2d'), {
      type: 'bar',
      data: {
        labels: D.dimensions.labels,
        datasets: [{ data: D.dimensions.values, backgroundColor: '#2563eb' }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  }
})();
</script>

</body>
</html>
